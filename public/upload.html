<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Mboard</title>
  </head>
  <body>
    <div class="md:container md:mx-auto text-center mt-10 shadow-lg">
      <input
        type="text"
        class="form-control border-solid border-2 border-indigo-600 w-6/12 rounded-md shadow-md"
        id="title"
        placeholder="title"
      />
      <textarea
        rows="5"
        class="form-control w-6/12 border-solid border-2 border-indigo-600 mt-2 rounded-md shadow-md"
        id="content"
        placeholder="write in contents"
      ></textarea>
      <input class="form-control w-6/12 mt-2" type="file" id="image" />
      <div class="px-4 py-3 bg-gray-50 text-center sm:px-6">
        <button
          type="submit"
          class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
          onclick="inputValue()"
        >
          Save
        </button>
      </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-storage.js"></script>

    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyDZOwgMxWu87by_E-2NWqWtcrNpQxAhT8o",
        authDomain: "mboard-49849.firebaseapp.com",
        projectId: "mboard-49849",
        storageBucket: "mboard-49849.appspot.com",
        messagingSenderId: "14676285341",
        appId: "1:14676285341:web:e4bb749720befaa6a20174",
        measurementId: "G-8WCMSZ3SRV",
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
    </script>
    <script>
      const db = firebase.firestore();
      const storage = firebase.storage();
      function inputValue() {
        if (document.getElementById("image").value == "") {
          let objects = {
            title: document.getElementById("title").value,
            contents: document.getElementById("content").value,
            name: "username",
            role: "userrole",
            date: new Date(),
          };
          db.collection("Board")
            .add(objects)
            .then(() => {
              alert("업로드 성공");
              window.location.href = "./index.html";
            })
            .catch((err) => {
              console.log(err);
              alert("업로드 실패, 올리기 버튼을 다시 눌러주세요.");
            });
        } else {
          let file = document.getElementById("image").files[0];
          let storageRef = storage.ref();
          let imagePath = storageRef.child("image/" + file.name);
          let uploadImg = imagePath.put(file);

          uploadImg.on(
            "state_changed",
            // 변화시 동작하는 함수
            null,
            //에러시 동작하는 함수
            (error) => {
              console.error("실패사유는", error);
            },
            // 성공시 동작하는 함수
            () => {
              uploadImg.snapshot.ref.getDownloadURL().then((url) => {
                let objects = {
                  title: document.getElementById("title").value,
                  contents: document.getElementById("content").value,
                  name: "username",
                  role: "userrole",
                  date: new Date(),
                  img: url,
                };
                db.collection("Board")
                  .add(objects)
                  .then(() => {
                    alert("업로드 성공");
                    window.location.href = "./index.html";
                  })
                  .catch((err) => {
                    console.log(err);
                    alert("업로드 실패, 올리기 버튼을 다시 눌러주세요.");
                  });
              });
            }
          );
        }
      }
    </script>
  </body>
</html>
